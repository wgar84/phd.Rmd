---
title: 
subtitle: A Phylogenetic Analysis of Covariance Structure in the Skull of Anthropoid Primates
author: Guilherme Garcia & Gabriel Marroig
job: University of SÃ£o Paulo - Brasil
date: June 28, 2015
output:
  revealjs::revealjs_presentation:
    transitions: concave
    mathjax: local
    self_contained: false
    fig_caption: true
    toc: true
    theme: moon
    smaller: true
  ioslides_presentation:
    transitions: faster
    mathjax: local
    self_contained: false
    fig_caption: true
    toc: true
  beamer_presentation:
    theme: "Malmoe"
    fig_caption: true
    fonttheme: "structurebold"
logo: evolution-logo-small.png
fontsize: 10pt
csl: ../../Bib/journal-of-evolutionary-biology.csl
bibliography: ../../Bib/tese.bib
---	

## Mammalian Skull Development {.flexbox .vcenter}

<div class='centered'>

![@hallgrimsson_mouse_2008](Figures/palimpsest.png)

</div>

<div class='notes'>

Morphological systems have a tendency to exhibit covariation among its components due to developmental interactions. In the mammalian skull, for instance, adult phenotypes are assembled by a series of developmental processes, and the timing, rate and scope of such processes structures covariance patterns.

</div>

## Landmarks and Measurements {.flexbox .vcenter}

<div class='centered'>

![`r captions $ fig.landmarks`](../../Figures/landmarks_pres1.png)

</div>

## Landmarks and Measurements {.flexbox .vcenter}

<div class='centered'>

![`r captions $ fig.landmarks`](../../Figures/landmarks_pres2.png)

</div>

## {.flexbox .vcenter}

<div class='centered'>

```{r phylo_model, echo = FALSE, fig.width = 7, fig.height = 6}
par(mar = c(1, 0, 0, 0))
plot.phylo(Tree [[1]],
           type = 'fan', cex = 0.5, label.offset = .03,
           use.edge.length = TRUE, y.lim = c(- 0.6, 0.6), x.lim = c(- 0.6, 0.6))

models.adj <- as.factor (Aux $ data.man.sp [, 2])

models.adj [30] <- 'SUB'

models.adj <- factor (as.character (models.adj),
                      levels = c('NONE', 'SUB', 'SEX', 'SUB + SEX', 'SUB * SEX'))

tiplabels(bg = brewer.pal(5, 'Set1') [as.numeric (models.adj)],
          cex = 2.2, pch = as.numeric (models.adj) + 20, col = NULL)

tiplabels(text = Aux $ sample.size, frame = 'none', cex = 0.5, col = 'white')

legend(0, 0,
       pch = 21:25,
       pt.cex = 1.3,
       cex = 0.7,
       col = 'white',
       pt.bg = brewer.pal(5, 'Set1'),
       legend = c('-', 'subsp/pop', 'sex', 'subsp/pop + sex', 'subsp/pop * sex'),
       bty = 'o', bg = 'white', xjust = 0.5, yjust = 0.5)
```

## {.flexbox .vcenter}

![](Figures/matrixspace.png)

## {.flexbox .vcenter}

<div class='centered'>

```{r phylo_decdiv, echo = FALSE, fig.width = 8, fig.height = 6}

par (mar = c(0, 0, 0, 0), fig = c(0, 0.9, 0, 1))
plot (Tree [[1]], type = 'fan', show.tip.label = FALSE,
      x.lim = c(-.6, .6), y.lim = c(-.48, .48))
nodelabels(cex = ppca.Data $ div.nodes.def * 100 / sum (ppca.Data $ div.nodes.def),
           frame = 'none', pch = 20)
Plot.taxa()

par(mar = c(0, 0, 0, 0), fig = c(0.7, 1, 0, 0.6), new = TRUE,
    bty = 'n', xaxt = 'n', yaxt = 'n')

plot (y = c(-2, -1, 0, 1, 2), x = c(0, 0, 0, 0, 0), pch = 20,
      cex =  c(0.25, 0.5, 0.75, 1, 1.25)[5:1] * 100 / sum (ppca.Data $ div.nodes.def),
      ylim = c(-3, 3))
text (y = c(-2, -1, 0, 1, 2), x = c(0, 0, 0, 0, 0) + 0.5,
      labels = paste (round (c(0.25, 0.5, 0.75, 1, 1.25)[5:1] * 100 /
        sum (ppca.Data $ div.nodes.def)), '%', sep = ''))

```

</div>

## {.flexbox .vcenter}

```{r riem_decdiv, echo = FALSE, warning = FALSE, message = FALSE}
kable (riem.tab)
```

## {.flexbox .vcenter}

<div class='centered'>

```{r ppca_eval, fig.width = 8, fig.height = 4, echo = FALSE, warning = FALSE, message = FALSE}
print (arrangeGrob(ppca.Plots $ eval.profile + guides(fill = FALSE),
                   ppca.Plots $ var.moran + guides(size = FALSE), ncol = 2))
```

</div>

## {.flexbox .vcenter}

<div class='centered'>

```{r phylo_g1, echo = FALSE, fig.width = 8, fig.height = 6}

values.axis <- etd.def.ppca $ li [, c(1, 2, 4, 3)]

par (mar = c(1.5, 1.5, 1.5, 1.5))
i <- 1
plot.phylo(Tree [[1]], type = 'fan',
           main = unique (ppca.Data $ SRD.limits.df $ axis) [i],
           use.edge.length = TRUE, show.tip.label = FALSE,
           y.lim = c(- 0.5, 0.5), x.lim = c(- 0.5, 0.5))

tiplabels(tip = 1:109, pch = 20,
          col = ifelse (values.axis [, i] < 0,
            rgb (0,0,1,0.5), rgb (1,0,0,0.5)), bg = NULL,
          cex = abs (values.axis[, i]))

Plot.taxa(TRUE)

legend('bottomright', bty = 'n', pt.cex = 1:4, yjust = 0.5,
       legend = 1:4, cex = 0.6, y.intersp = 2, x.intersp = 2, 
       pch = 20, col = rgb (0,0,0,0.5))
```

</div>

## {.flexbox .vcenter} 

```{r phylo_g2, echo = FALSE, fig.width = 8, fig.height = 6}

par (mar = c(1.5, 1.5, 1.5, 1.5))
i <- 2
plot.phylo(Tree [[1]], type = 'fan',
           main = unique (ppca.Data $ SRD.limits.df $ axis) [i],
           use.edge.length = TRUE, show.tip.label = FALSE,
           y.lim = c(- 0.5, 0.5), x.lim = c(- 0.5, 0.5))

tiplabels(tip = 1:109, pch = 20,
          col = ifelse (values.axis [, i] < 0,
            rgb (0,0,1,0.5), rgb (1,0,0,0.5)), bg = NULL,
          cex = abs (values.axis[, i]))

Plot.taxa(TRUE)

legend('bottomright', bty = 'n', pt.cex = 1:4, yjust = 0.5,
       legend = 1:4, cex = 0.6, y.intersp = 2, x.intersp = 2, 
       pch = 20, col = rgb (0,0,0,0.5))
```

</div>

## {.flexbox .vcenter}

<div class='centered'>

```{r srd_g1, echo = FALSE, fig.width = 8, fig.height = 6}
ppca.Data $ post.arc %>%
  separate(axis, into = c('struct', 'order')) %>%
  filter(Type == 'Local Shape Variables', struct == 'Global', order == 1) %>%
  ggplot (.) +
  geom_boxplot (aes (x = trait, y = value, color = hyp),
                outlier.shape = '+', notch = TRUE) +
#  facet_grid(struct ~ order, scales = 'free_y') +
  geom_hline (aes (yintercept = value),
              ppca.Data $ mean.post.arc.def %>%
              filter(struct == 'Global', order == 1), linetype = 'dotted') +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, size = 6)) +
  scale_color_brewer(name = 'Region', palette = 'Dark2') +
  xlab('Trait') + ylab('Posterior SRD Mean') + labs(title = 'Global 1')

```

</div>


## {.flexbox .vcenter}

<div class='centered'>

```{r srd_g2, echo = FALSE, fig.width = 8, fig.height = 6}
ppca.Data $ post.arc %>%
  separate(axis, into = c('struct', 'order')) %>%
  filter(Type == 'Local Shape Variables', struct == 'Global', order == 2) %>%
  ggplot (.) +
  geom_boxplot (aes (x = trait, y = value, color = hyp),
                outlier.shape = '+', notch = TRUE) +
#  facet_grid(struct ~ order, scales = 'free_y') +
  geom_hline (aes (yintercept = value),
              ppca.Data $ mean.post.arc.def %>%
              filter(struct == 'Global', order == 2), linetype = 'dotted') +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, size = 6)) +
  scale_color_brewer(name = 'Region', palette = 'Dark2') +
  xlab('Trait') + ylab('Posterior SRD Mean') + labs(title = 'Global 2')

```

</div>

## {.flexbox .vcenter}

<div class='centered'>

```{r srd_shape_global, echo = FALSE, fig.width = 8, fig.height = 6}
ppca.Data $ post.arc %>%
  filter(Type == 'Local Shape Variables') %>%
  mutate('trait2' = factor (as.character(trait), levels = rownames (Aux $ def.hyp))) %>%
  group_by(axis, trait2) %>%
  summarise_each(funs(mean), value) %$%
  {
    for (i in 1:2)
      {
        current.value <- value [axis == levels (axis) [i]]
        PlotShapeDeformation(Reference [, , 'Macaca_mulatta'], Aux $ tessel.38,
                             ColorsContinuous = c(current.value [-1], current.value [-1]),
                             palette = colorRamp(c('red', 'green'), space = 'Lab'),
                             view = c(1, 2), bty = 'n', add = ifelse (i == 1, F, T),
                             center = c(-0.5, -i, 0),
                             ylim = c(-2.2, -0.8), xlim = c(-1.3, 1), scale = 1.5,
                             graph.par = list ('mar' = c(0, 0, 0, 0)))
        PlotShapeDeformation(Reference [, , 'Macaca_mulatta'], Aux $ tessel.38,
                             ColorsContinuous = c(current.value [-1], current.value [-1]),
                             palette = colorRamp(c('red', 'green'), space = 'Lab'),
                             view = c(1, 3), bty = 'n', add = T, center = c(0.5, 0, -i),
                             scale = 1.5)
        if (i < 2)
          abline(h = - i - 0.5)
      }
  }
text(y = -(1:2), x = rep (-1.2, 2),
     labels = c('Global 1', 'Global 2'))
```

</div>

## {.flexbox .vcenter}

<div class='centered'>

```{r phylo_l1, echo = FALSE, fig.width = 8, fig.height = 6}

par (mar = c(1.5, 1.5, 1.5, 1.5))
i <- 3
plot.phylo(Tree [[1]], type = 'fan',
           main = unique (ppca.Data $ SRD.limits.df $ axis) [i],
           use.edge.length = TRUE, show.tip.label = FALSE,
           y.lim = c(- 0.5, 0.5), x.lim = c(- 0.5, 0.5))

tiplabels(tip = 1:109, pch = 20,
          col = ifelse (values.axis [, i] < 0,
            rgb (0,0,1,0.5), rgb (1,0,0,0.5)), bg = NULL,
          cex = abs (values.axis[, i]))

Plot.taxa(TRUE)

legend('bottomright', bty = 'n', pt.cex = 1:4, yjust = 0.5,
       legend = 1:4, cex = 0.6, y.intersp = 2, x.intersp = 2, 
       pch = 20, col = rgb (0,0,0,0.5))
```

</div>

## {.flexbox .vcenter}

<div class='centered'>

```{r phylo_l2, echo = FALSE, fig.width = 8, fig.height = 6}

values.axis <- etd.def.ppca $ li [, c(1, 2, 4, 3)]

par (mar = c(1.5, 1.5, 1.5, 1.5))
i <- 4
plot.phylo(Tree [[1]], type = 'fan',
           main = unique (ppca.Data $ SRD.limits.df $ axis) [i],
           use.edge.length = TRUE, show.tip.label = FALSE,
           y.lim = c(- 0.5, 0.5), x.lim = c(- 0.5, 0.5))

tiplabels(tip = 1:109, pch = 20,
          col = ifelse (values.axis [, i] < 0,
            rgb (0,0,1,0.5), rgb (1,0,0,0.5)), bg = NULL,
          cex = abs (values.axis[, i]))

Plot.taxa(TRUE)

legend('bottomright', bty = 'n', pt.cex = 1:4, yjust = 0.5,
       legend = 1:4, cex = 0.6, y.intersp = 2, x.intersp = 2, 
       pch = 20, col = rgb (0,0,0,0.5))
```

</div>

## {.flexbox .vcenter}

<div class='centered'>

```{r srd_l1, echo = FALSE, fig.width = 8, fig.height = 6}
ppca.Data $ post.arc %>%
  separate(axis, into = c('struct', 'order')) %>%
  filter(Type == 'Local Shape Variables', struct == 'Local', order == 1) %>%
  ggplot (.) +
  geom_boxplot (aes (x = trait, y = value, color = hyp),
                outlier.shape = '+', notch = TRUE) +
#  facet_grid(struct ~ order, scales = 'free_y') +
  geom_hline (aes (yintercept = value),
              ppca.Data $ mean.post.arc.def %>%
              filter(struct == 'Local', order == 1), linetype = 'dotted') +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, size = 6)) +
  scale_color_brewer(name = 'Region', palette = 'Dark2') +
  xlab('Trait') + ylab('Posterior SRD Mean') + labs(title = 'Local 1')

```

</div>

## {.flexbox .vcenter}

<div class='centered'>

```{r srd_l2, echo = FALSE, fig.width = 8, fig.height = 6}
ppca.Data $ post.arc %>%
  separate(axis, into = c('struct', 'order')) %>%
  filter(Type == 'Local Shape Variables', struct == 'Local', order == 2) %>%
  ggplot (.) +
  geom_boxplot (aes (x = trait, y = value, color = hyp),
                outlier.shape = '+', notch = TRUE) +
#  facet_grid(struct ~ order, scales = 'free_y') +
  geom_hline (aes (yintercept = value),
              ppca.Data $ mean.post.arc.def %>%
              filter(struct == 'Local', order == 2), linetype = 'dotted') +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, size = 6)) +
  scale_color_brewer(name = 'Region', palette = 'Dark2') +
  xlab('Trait') + ylab('Posterior SRD Mean') + labs(title = 'Local 2')

```

</div>

## {.flexbox .vcenter}

<div class='centered'>

```{r srd_shape_local, echo = FALSE, fig.width = 8, fig.height = 6}
ppca.Data $ post.arc %>%
  filter(Type == 'Local Shape Variables') %>%
  mutate('trait2' = factor (as.character(trait), levels = rownames (Aux $ def.hyp))) %>%
  group_by(axis, trait2) %>%
  summarise_each(funs(mean), value) %$%
  {
    for (i in 3:4)
      {
        current.value <- value [axis == levels (axis) [i]]
        PlotShapeDeformation(Reference [, , 'Macaca_mulatta'], Aux $ tessel.38,
                             ColorsContinuous = c(current.value [-1], current.value [-1]),
                             palette = colorRamp(c('red', 'green'), space = 'Lab'),
                             view = c(1, 2), bty = 'n', add = ifelse (i == 3, F, T),
                             center = c(-0.5, -i, 0),
                             ylim = c(-4.2, -2.8), xlim = c(-1.3, 1), scale = 1.5,
                             graph.par = list ('mar' = c(0, 0, 0, 0)))
        PlotShapeDeformation(Reference [, , 'Macaca_mulatta'], Aux $ tessel.38,
                             ColorsContinuous = c(current.value [-1], current.value [-1]),
                             palette = colorRamp(c('red', 'green'), space = 'Lab'),
                             view = c(1, 3), bty = 'n', add = T, center = c(0.5, 0, -i),
                             scale = 1.5)
        if (i < 4)
          abline(h = - i - 0.5)
      }
  }
text(y = -(3:4), x = rep (-1.2, 2),
     labels = c('Local 1', 'Local 2'))
```

</div>

## References {.smaller}

<div class='columns-2'>
